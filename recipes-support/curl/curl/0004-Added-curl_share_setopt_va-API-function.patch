From 63db75b1009c15ba646e439b8c055879cb11e479 Mon Sep 17 00:00:00 2001
From: Jonathan David <jonathan.david@ni.com>
Date: Mon, 21 Jul 2014 14:25:07 -0500
Subject: [PATCH] Added curl_share_setopt_va() API function

Added API function with `va_list` variable argument parameter in
addition to cURL's function using `...`.

Upstream-Status: Denied

https://curl.se/mail/lib-2017-01/0139.html

This patchset was denied by upstream because they did not agree that our
usecase for these added functions were valid - and we did not have a
defense.

https://curl.se/mail/lib-2017-01/0146.html

Signed-off-by: Alex Stewart <alex.stewart@ni.com>
---
 lib/share.c | 18 +++++++++++++-----
 1 file changed, 13 insertions(+), 5 deletions(-)

diff --git a/lib/share.c b/lib/share.c
index 8fa5cda..d3121ff 100644
--- a/lib/share.c
+++ b/lib/share.c
@@ -49,11 +49,9 @@ curl_share_init(void)
   return share;
 }
 
-#undef curl_share_setopt
 CURLSHcode
-curl_share_setopt(struct Curl_share *share, CURLSHoption option, ...)
+curl_share_setopt_va(struct Curl_share *share, CURLSHoption option, va_list param)
 {
-  va_list param;
   int type;
   curl_lock_function lockfunc;
   curl_unlock_function unlockfunc;
@@ -68,8 +66,6 @@ curl_share_setopt(struct Curl_share *share, CURLSHoption option, ...)
        using this share */
     return CURLSHE_IN_USE;
 
-  va_start(param, option);
-
   switch(option) {
   case CURLSHOPT_SHARE:
     /* this is a type this share will share */
@@ -202,6 +198,18 @@ curl_share_setopt(struct Curl_share *share, CURLSHoption option, ...)
     break;
   }
 
+  return res;
+}
+
+#undef curl_share_setopt
+CURLSHcode
+curl_share_setopt(struct Curl_share *share, CURLSHoption option, ...)
+{
+  CURLSHcode res;
+  va_list param;
+  va_start(param, option);
+
+  res = curl_share_setopt_va(share, option, param);
   va_end(param);
 
   return res;
