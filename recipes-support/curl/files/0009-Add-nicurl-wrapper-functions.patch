From 21cbf3775d5a504044e9e9352161c7f53cc51969 Mon Sep 17 00:00:00 2001
From: Jonathan David <jonathan.david@ni.com>
Date: Tue, 15 Mar 2016 13:26:34 -0500
Subject: [PATCH 09/22] Add nicurl wrapper functions

Added the following API wrapper functions:
nicurl_easy_getinfo
nicurl_easy_setopt
nicurl_formadd
nicurl_multi_setopt
nicurl_share_setopt

These functions are called by older NI components, and exist as
a means to keep previous code running.

Upstream-Status: Inappropriate [NI specific changes]
---
 lib/easy.c     | 21 +++++++++++++++++++++
 lib/formdata.c | 12 ++++++++++++
 lib/multi.c    | 11 +++++++++++
 lib/share.c    | 11 +++++++++++
 4 files changed, 55 insertions(+)

diff --git a/lib/easy.c b/lib/easy.c
index e5c2be3..0091d08 100644
--- a/lib/easy.c
+++ b/lib/easy.c
@@ -412,6 +412,16 @@ CURLcode curl_easy_setopt(CURL *curl, CURLoption tag, ...)
   return result;
 }
 
+#ifdef ENABLE_NICURL_API
+CURL_EXTERN CURLcode nicurl_easy_setopt(CURL *curl, CURLoption tag, va_list arg)
+{
+  CURLcode result;
+  result = curl_easy_setopt_va(curl, tag, arg);
+  va_end(arg);
+  return result;
+}
+#endif
+
 #ifdef CURLDEBUG
 
 struct socketmonitor {
@@ -891,6 +901,17 @@ CURLcode curl_easy_getinfo(CURL *curl, CURLINFO info, ...)
   return result;
 }
 
+#ifdef ENABLE_NICURL_API
+CURL_EXTERN CURLcode nicurl_easy_getinfo(CURL *curl, CURLINFO info, va_list arg)
+{
+/* Unlike other nicurl functions, this one did not previously call va_start()
+ * nor va_end(). Thus, it can behave as expected of variadic functions that
+ * are passed va_list.
+ */
+  return curl_easy_getinfo_va(curl, info, arg);
+}
+#endif
+
 /*
  * curl_easy_duphandle() is an external interface to allow duplication of a
  * given input easy handle. The returned handle will be a new working handle
diff --git a/lib/formdata.c b/lib/formdata.c
index 9fae83f..6a146f7 100644
--- a/lib/formdata.c
+++ b/lib/formdata.c
@@ -745,6 +745,18 @@ CURLFORMcode curl_formadd(struct curl_httppost **httppost,
   return result;
 }
 
+#ifdef ENABLE_NICURL_API
+CURL_EXTERN CURLFORMcode nicurl_formadd(struct curl_httppost **httppost,
+                                        struct curl_httppost **last_post,
+                                        va_list arg)
+{
+  CURLFORMcode result;
+  result = curl_formadd_va(httppost, last_post, arg);
+  va_end(arg);
+  return result;
+}
+#endif
+
 #ifdef __VMS
 #include <fabdef.h>
 /*
diff --git a/lib/multi.c b/lib/multi.c
index fabef7a..b12de36 100644
--- a/lib/multi.c
+++ b/lib/multi.c
@@ -2408,6 +2408,17 @@ CURLMcode curl_multi_setopt(CURLM *multi_handle,
   return res;
 }
 
+#ifdef ENABLE_NICURL_API
+CURL_EXTERN CURLMcode nicurl_multi_setopt(CURLM *multi_handle,
+                            CURLMoption option, va_list param)
+{
+  CURLMcode result;
+  result = curl_multi_setopt_va(multi_handle, option, param);
+  va_end(param);
+  return result;
+}
+#endif
+
 /* we define curl_multi_socket() in the public multi.h header */
 #undef curl_multi_socket
 
diff --git a/lib/share.c b/lib/share.c
index f78bc40..1220b1f 100644
--- a/lib/share.c
+++ b/lib/share.c
@@ -182,6 +182,17 @@ curl_share_setopt(CURLSH *sh, CURLSHoption option, ...)
   return res;
 }
 
+#ifdef ENABLE_NICURL_API
+CURLSHcode
+CURL_EXTERN nicurl_share_setopt(CURLSH *sh, CURLSHoption option, va_list param)
+{
+  CURLSHcode result;
+  result = curl_share_setopt_va(sh, option, param);
+  va_end(param);
+  return result;
+}
+#endif
+
 CURLSHcode
 curl_share_cleanup(CURLSH *sh)
 {
-- 
1.9.1

